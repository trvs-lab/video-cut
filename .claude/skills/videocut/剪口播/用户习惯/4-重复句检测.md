<!--
input: 按静音分隔的句子列表
output: 重复句索引列表
pos: 规则，建议删优先级

架构守护者：一旦我被修改，请同步更新：
1. 所属文件夹的 README.md
-->

# 重复句检测

## 定义

相邻句子（被静音分隔）开头相同 ≥5字，通常是说错后重说。

## 核心原则

**先分句，再比对**：必须先按静音切分成句子列表，然后比对相邻句子。

## 正确分析方法

```
✓ 正确：按静音切分句子 → 比对相邻句子开头 → 整句删除
✗ 错误：逐字扫描 → 发现重复片段 → 只删片段
```

### 步骤

1. **按静音切分句子**（静音≥0.5s作为分隔）
2. **比对相邻句子**（开头≥5字相同 → 删较短的整句）
3. **比对隔一句**（中间是残句时，也要检查前后句是否重复）

## 检测逻辑

```javascript
// 相邻句子比对
if (curr.text.slice(0, 5) === next.text.slice(0, 5)) {
  const shorter = curr.text.length <= next.text.length ? curr : next;
  markAsError(shorter);  // 删除整句，不只是重复部分
}

// 隔一句比对（中间是短句/残句时）
if (mid.text.length <= 5) {  // 中间是残句
  if (curr.text.slice(0, 5) === next.text.slice(0, 5)) {
    markAsError(curr);   // 删前句
    markAsError(mid);    // 删残句
  }
}
```

## 案例

| 前句 | 后句 | 删除 |
|------|------|------|
| "这是我剪出来的一个案例" | "这是我剪出来的一个案例" | 前句（完全重复） |
| "我用cloud code的excuse功能做一个剪辑agent" | "所以我用cloud code的excuse功能做一个剪辑agent" | 前句 |
| "第二个是是q制技能系统第二个" | "第二个是scale技能系统" | 前句 |
| "好我们接下来开始怎么去" | "好我们接下来开始怎么去做一个剪口拨" | 前句 |
| "我们就可以看到这里新的视频" | "我们就可以看到这里新的视频了" | 前句 |

## 隔一句重复（中间有残句）

当两句之间隔了一个短残句时，也要检测：

```
句A: "这是我剪出来的一个案例"
残句: "他呢"                    ← 中间隔了残句
句B: "这是我剪出来的一个案例"

→ 删 句A + 残句
```

| 前句 | 中间残句 | 后句 | 删除 |
|------|---------|------|------|
| "这是我剪出来的一个案例" | "他呢" | "这是我剪出来的一个案例" | 前句 + 残句 |
| "具体怎么做呢我们首先下载这个" | "提示词" | "具体怎么做呢我们首先复制这个提示词" | 前句 + 残句 |
| "打开我们的AI" | "打开我们的" | "打开我们的AI然后告诉他去下载" | 前句 + 残句 |

## 多次重复

连续说 3 次以上，删除所有不完整的，保留最后完整的：

```
"以前呢我会把所有的技能"     → 删
"以前呢我会把所有的功能做"   → 删
"以前呢我会把所有的功能做都" → 删
"以前呢我会把所有的功能都做成一个大的scale" → 保留
```

## 易错点

```
❌ 逐字扫描，只发现局部重复片段
✓ 先分句，比对整句开头，删除整句

❌ 只比对相邻句子
✓ 也要比对隔一句（中间可能是残句）
```
